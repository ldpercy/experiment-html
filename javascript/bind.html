<!doctype html>
<html lang="en">
<head>
	<title>bind</title>
	<meta charset="utf-8">
	<link rel="icon" href="../favicon.svg">
	<link rel="stylesheet" href="../[common]/common-style.css">

	<script defer src="../[common]/common-script.js"></script>

</head>
<body>
	<header>
		<h1><a href="">bind</a></h1>
		<nav>
			<a class="colourScheme-selector" href="?colourScheme=light" title="Light colour scheme" data-colourscheme="light">ðŸŸ“</a>
			<a class="colourScheme-selector" href="?colourScheme=dark" title="Dark colour scheme" data-colourscheme="dark">ðŸŸ’</a>
			<a title="To folder" href="./">ðŸ–¿</a>
			<a title="Parent folder" href="../">ðŸ¡…</a>
		</nav>
	</header>

	<script type="module" src="../[html-common]/script/colourScheme-selector.js"></script>

	<p>
		Something weird going on with 'this' binding that I want to figure out.
	</p>

	<main>



	<script>

		fnmap = {
			a : f1,
			b : f2,
			c : f3,
			r : report,
		};

		function f1(a,b,c)			{ return `(${a},${b},${c})`; }	// takes anonymous args
		function f2({a,b,c})		{ return `(${a},${b},${c})`; }	// takes args named abc
		function f3({x:a,y:b,z:c})	{ return `(${a},${b},${c})`; }	// renames xyz to abc

		function report() {
			console.log('Report this:', this);
		}

		report();			// Report this: Window http://localhost:9001/experiment-html/javascript/bind.html#
		fnmap.r();			// Report this: Object { a: f1(a, b, c), b: f2(), c: f3(), r: report() }

	</script>

	<pre>
		called raw `report` gives window as this
		called as fnmap.r() it gives the fnmap object as this
	</pre>

	<script>
		class Animal {
			name;
			constructor(name) {	this.name = name; }

			fnmap = {
				a	: f1,
				b	: f2,
				c	: f3,
				r	: report,
				r2	: report.bind(this),		// this seems to work, bit awkward though
			};

			f1(a,b,c)			{ return `(${a},${b},${c})`; }	// takes anonymous args
			f2({a,b,c})			{ return `(${a},${b},${c})`; }	// takes args named abc
			f3({x:a,y:b,z:c})	{ return `(${a},${b},${c})`; }	// renames xyz to abc
			report() 			{ console.log('Report this:', this); }

			callFunc(funcName) {
				this.fnmap[funcName]();
			}

			callFuncWithBind(funcName) {
				this.fnmap[funcName].bind(this)();			// !!! this appear to work more generally
			}

		}/* Animal */

		a = new Animal('Grizz');
		a.report();				// Report this: Object { name: "Grizz", fnmap: {â€¦} }
		a.fnmap.r();			// Report this: Object { a: f1(a, b, c), b: f2(), c: f3(), r: report() }
		a.fnmap.r2();			// Report this: Object { name: "Grizz", fnmap: {â€¦} }
		a.callFunc('r');		// Report this: Object { a: f1(a, b, c), b: f2(), c: f3(), r: report() }
		a.callFunc('r2');		// Report this: Object { name: "Grizz", fnmap: {â€¦} }

		a.callFuncWithBind('r');		// Report this: Object { name: "Grizz", fnmap: {â€¦} }
		a.callFuncWithBind('r2');		// Report this: Object { name: "Grizz", fnmap: {â€¦} }

	</script>

	<pre>
		This appears to be the more general solution:

			this.fnmap[funcName].bind(this)();
	</pre>

	</main>
</body>
</html>