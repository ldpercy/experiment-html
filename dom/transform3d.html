<!doctype html>
<html lang="en">
<head>
	<title>transform 3d</title>
	<meta charset="utf-8">
	<link rel="icon" href="../[common]/favicon.svg">
	<link rel="stylesheet" href="../[common]/common-style.css">
	<link rel="stylesheet" href="../[common]/form.css">

</head>
<body onload="formOnchange()">
	<header>
		<nav>
			<a id="button-lightScheme" href="#" title="Light scheme" data-scheme="light">ðŸŸ“</a>
			<a id="button-darkScheme" href="#" title="Dark scheme" data-scheme="dark">ðŸŸ’</a>
			<a title="To folder" href="./">ðŸ–¿</a>
			<a title="Parent folder" href="../">ðŸ¡…</a>
		</nav>

		<h1><a href="">transform 3d</a></h1>
	</header>

	<link rel="stylesheet" href="../[html-common]/style/svg/grid.css"/>

	<main>

		<style contenteditable="plaintext-only" spellcheck="false" class="limit-height">
			* { transition: all ease-in 0.5s; }
			svg {
				outline:2px dashed var(--svg-orange);
				margin:1ex;
				border-radius: 1ex;
			}
			form { z-index:5; }
			output { grid-column-start: span 3; }
			form { grid-column-start: span 1; }

			figure { filter: drop-shadow(0px 1ex 1ex grey); }

			table.matrix {
				table-layout: fixed;
				margin:1em;
				width:90%;
				td {text-align:right;}
			}
		</style>

<!-- 		<script type="module">
			import * as planar from '../[html-common]/module/PlanarSpace.js'
			import * as svg from '../[html-common]/module/SVG.js'

			let space = new planar.Space('simple space');
			let box = new svg.Box(-1200,-600,2400,1200);
			//console.log(box);

			const cartesianGrid = new svg.CartesianGrid(space, box);
			const svgGrid = document.getElementById('svgGrid');
			svgGrid.innerHTML = cartesianGrid.toString();

		</script> -->

		<style contenteditable="plaintext-only" spellcheck="false" class="limit-height">
			.grid-container {
				display: grid;
				grid-template-columns: 1fr 1fr 1fr ;
				border: 2px solid green;
				margin:1ex;	padding:1ex; border-radius:1ex;
				&>* { margin:inherit; padding:inherit; border-radius:inherit;	}

				section {
					grid-column-start: 1;
					grid-column-end: 3;
				}
				aside { grid-column-start: 2; }
			}
			.transform-element {
				/* transform: rotateX(15deg) rotateY(10deg) rotateZ(5deg) translateX(3em); */
				perspective: 20cm;
				perspective-origin: 50% 50%;
				section { transform: translateZ(4em); }
				aside { transform: translateZ(8em); }

			}

		</style>

		<output class="pretty">
			<!--
			<svg id="svgDoc1" viewBox="-1200 -600 2400 1200">
				<g>
					<g id="svgGrid" class="grid"></g>
					<polyline points="100,-100 400,-300 400,-100" style="stroke:red;stroke-width:10px;fill:#f007;"/>
				</g>
			</svg>
			-->
			<code id="matrix-display"></code>
			<figure>
				<div id="transform-element" class="transform-element grid-container ">
					<div>abcd</div>
					<div>efgh</div>
					<p>ijkl</p>

					<section>mnop</section>
					<aside>qrst</aside>
					<div>uvwx</div>
					<div>yz</div>
				</div>
			</figure>
		</output>

		<form name="matrix" onchange="formOnchange()">

			<h2>mutators</h2>

			<label><input name="rotateX" type="number" value="0" step="15"> rotateX </label>
			<label><input name="rotateY" type="number" value="0" step="15"> rotateY </label>
			<label><input name="rotateZ" type="number" value="0" step="15"> rotateZ </label>

			<label>
				<input type="checkbox" name="invert"> invert
			</label>

			<button type="reset" onclick="formReset()">reset</button>
		</form>



		<script>
			let matrix;
			const transformElement = document.getElementById('transform-element');
			const matrixDisplay = document.getElementById('matrix-display');

			function formOnchange() {
				//console.log('formOnchange')
				matrix = new DOMMatrix();

				matrix.rotateSelf(
					document.forms.matrix.rotateX.value,
					document.forms.matrix.rotateY.value,
					document.forms.matrix.rotateZ.value,
				);

				if (document.forms.matrix.invert.checked) {
					matrix.invertSelf();
				}

				console.log(matrix);
				//matrixDisplay.innerHTML = matrix.toString();

				transformElement.style.setProperty('transform', matrix.toString());
				matrixDisplay.innerHTML = asTable(matrix);
			}

			function formReset() {
				//console.log('formReset');
				matrix = new DOMMatrix();
				transformElement.style.setProperty('transform', matrix.toString());
				matrixDisplay.innerHTML = asTable(matrix);
			}


			function asTable(matrix3d) {
				result =`
					<table class="matrix">
					<thead>
						<tr><th></th><th>matrix.m1_</th><th>matrix.m2_</th><th>matrix.m3_</th><th>matrix.m4_</th></tr>
					</thead>
					<tr><th>matrix.m_1</th><td>${matrix.m11}</td><td>${matrix.m21}</td><td>${matrix.m31}</td><td>${matrix.m41}</td></tr>
					<tr><th>matrix.m_2</th><td>${matrix.m12}</td><td>${matrix.m22}</td><td>${matrix.m32}</td><td>${matrix.m42}</td></tr>
					<tr><th>matrix.m_3</th><td>${matrix.m13}</td><td>${matrix.m23}</td><td>${matrix.m33}</td><td>${matrix.m43}</td></tr>
					<tr><th>matrix.m_4</th><td>${matrix.m14}</td><td>${matrix.m24}</td><td>${matrix.m34}</td><td>${matrix.m44}</td></tr>
					</table>
				`;
				return result;
			}

		</script>




		<!--


			/* 2D */
			const point2D = new DOMPointReadOnly(50, 50);

			/* 3D */
			const point3D = new DOMPointReadOnly(50, 50, 25);

			/* 3D with perspective */
			const point3DPerspective = new DOMPointReadOnly(100, 100, 100, 1.0);

			const point = new DOMPoint(5, 4);
			const scaleX = 2;
			const scaleY = 3;
			const translateX = 12;
			const translateY = 8;
			const angle = Math.PI / 2;
			const matrix = new DOMMatrix([
				Math.cos(angle) * scaleX,
				Math.sin(angle) * scaleX,
				-Math.sin(angle) * scaleY,
				Math.cos(angle) * scaleY,
				translateX,
				translateY,
			]);
			const transformedPoint = point.matrixTransform(matrix);

			//console.log(matrix);
			//console.log(transformedPoint);
			function logTransform(p,matrix) { console.dir(p, p.matrixTransform(matrix)); }
		-->


	</main>


</body>
</html>