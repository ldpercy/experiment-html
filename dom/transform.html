<!doctype html>
<html lang="en">
<head>
	<title>transform</title>
	<meta charset="utf-8">
	<link rel="icon" href="../[common]/html-experiment.svg">
	<link rel="stylesheet" href="../[common]/common-style.css">
	<link rel="stylesheet" href="../[common]/form.css">
	<script defer src="../[common]/colourScheme-selector.js"></script>
</head>
<body>
	<header>
		<nav>
			<a class="colourScheme-selector" href="?colourScheme=light" title="Light colour scheme" data-colourscheme="light">ðŸŸ“</a>
			<a class="colourScheme-selector" href="?colourScheme=dark" title="Dark colour scheme" data-colourscheme="dark">ðŸŸ’</a>
			<a title="To folder" href="./">ðŸ–¿</a>
			<a title="Parent folder" href="../">ðŸ¡…</a>
		</nav>

		<h1><a href="">transform</a></h1>
	</header>

	<link rel="stylesheet" href="../[html-common]/style/svg/grid.css"/>
	<script defer src="../[common]/colourScheme-selector.js"></script>

	<main>

		<style contenteditable="plaintext-only" spellcheck="false" class="limit-height">
			* { transition: all ease-in 0.5s; }
			svg { margin:1ex; border-radius:1ex; outline:2px dashed var(--svg-orange); }
			form { z-index:5; }

			output { grid-column-start: span 3; }
			form { grid-column-start: span 1; }

			.matrixValues {
				display:grid;
				grid-template-columns: 1fr 1fr 1fr;
				label { white-space: pre-line; text-align:center; }
			}
		</style>

		<script type="module">
			import * as planar from '../[html-common]/module/PlanarSpace.js'
			import * as svg from '../[html-common]/module/SVG.js'

			let space = new planar.Space('simple space');
			let box = new svg.Box(-1200,-600,2400,1200);
			//console.log(box);

			const cartesianGrid = new svg.CartesianGrid(space, box);
			const svgGrid = document.getElementById('svgGrid');
			svgGrid.innerHTML = cartesianGrid.toString();

		</script>
		<output>
			<svg id="svgDoc1" viewBox="-1200 -600 2400 1200">
				<g id="transform-group">
					<g id="svgGrid" class="grid"></g>
					<polyline points="100,-100 400,-300 400,-100" style="stroke:red;stroke-width:10px;fill:#f007;"/>
				</g>
			</svg>
		</output>
		<form name="matrix" onchange="formOnchange()">
			<h2>initial matrix values</h2>
			<div class="matrixValues">
			<label>
				<input name="a" type="number" value="1" min="-5" max="5" step="0.5">
				a - scaleX
			</label>
			<label>
				<input name="b" type="number" value="0" min="-5" max="5" step="0.5">
				b - skewY
			</label>
			<label>
				<input name="c" type="number" value="0" min="-5" max="5" step="0.5">
				c - skewX
			</label>
			<label>
				<input name="d" type="number" value="1" min="-5" max="5" step="0.5">
				d - scaleY
			</label>
			<label>
				<input name="e" type="number" value="0" min="-100" max="100" step="25">
				e - translateX
			</label>
			<label>
				<input name="f" type="number" value="0" min="-100" max="100" step="25">
				f - translateY
			</label>
			</div>

			<h2>mutators</h2>

			<label><input name="rotate" type="number" value="0" min="-180" max="180" step="15"> rotate </label>
			<label>
				<input type="checkbox" name="invert"> invert
			</label>

			<button type="reset" onclick="formReset()">reset</button>
		</form>


		<script contenteditable="true">
			//const transformGroup = document.getElementById('transform-group');
			const transformGroup = document.getElementById('svgDoc1');

			function formOnchange() {
				//console.log('formOnchange')
				let matrix = new DOMMatrix([
					document.forms.matrix.a.value,
					document.forms.matrix.b.value,
					document.forms.matrix.c.value,
					document.forms.matrix.d.value,
					document.forms.matrix.e.value,
					document.forms.matrix.f.value,
				]);

				matrix.rotateSelf(document.forms.matrix.rotate.value);

				if (document.forms.matrix.invert.checked) {
					matrix.invertSelf();
				}

				console.log(matrix);
				transformGroup.setAttribute('transform', matrix.toString());

			}

			const identity = new DOMMatrixReadOnly([
				1, 0, 0,
				1, 0, 0,
			]);

			function formReset() {
				console.log('formReset', identity);
				transformGroup.setAttribute('transform', identity);
			}


			function rotate(degrees) {
				const radians = (degrees/180) * Math.PI;
				const result = new DOMMatrix([
					Math.cos(angle) * scaleX,
					Math.sin(angle) * scaleX,
					-Math.sin(angle) * scaleY,
					Math.cos(angle) * scaleY,
					translateX,
					translateY,
				]);
				return result;
			}


		</script>

	</main>

</body>
</html>