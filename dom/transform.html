<!doctype html>
<html lang="en">
<head>
	<title>transform</title>
	<meta charset="utf-8">
	<link rel="icon" href="../[common]/favicon.svg">
	<link rel="stylesheet" href="../[common]/common-style.css">
	<link rel="stylesheet" href="../[common]/form.css">

</head>
<body>
	<header>
		<nav>
			<a id="button-lightScheme" href="#" title="Light scheme" data-scheme="light">ðŸŸ“</a>
			<a id="button-darkScheme" href="#" title="Dark scheme" data-scheme="dark">ðŸŸ’</a>
			<a title="To folder" href="./">ðŸ–¿</a>
			<a title="Parent folder" href="../">ðŸ¡…</a>
		</nav>

		<h1><a href="">transform</a></h1>
	</header>

	<link rel="stylesheet" href="../[html-common]/style/svg/grid.css"/>

	<main>

		<style contenteditable="plaintext-only" spellcheck="false" class="limit-height">
			* { transition: all ease-in 0.5s; }
			svg { margin:1ex; border-radius:1ex; outline:2px dashed var(--svg-orange); }
			main {
				display:grid;
				style, script {
					grid-column-start: span 2;
				}
				.limit-height {
					max-height:30em;
					overflow-y: scroll;
				}
			}

			@media (orientation: landscape) {
				main { grid-template-columns: 1fr 1fr 1fr 1fr; }
				output { grid-column-start: span 3; }
				form { grid-column-start: span 1; }
			}

			@media (orientation: portrait) {
				main { grid-template-columns: 1fr 1fr ; }
				output { grid-column-start: span 2; }
				form { grid-column-start: span 2; }
			}

			.matrixValues { display:grid; grid-template-columns: 1fr 1fr 1fr; label { white-space: pre-line; text-align:center; }	}
		</style>

		<script type="module">
			import * as planar from '../[html-common]/module/PlanarSpace.js'
			import * as svg from '../[html-common]/module/SVG.js'

			let space = new planar.Space('simple space');
			let box = new svg.Box(-1200,-600,2400,1200);
			//console.log(box);

			const cartesianGrid = new svg.CartesianGrid(space, box);
			const svgGrid = document.getElementById('svgGrid');
			svgGrid.innerHTML = cartesianGrid.toString();

		</script>
		<output>
			<svg id="svgDoc1" viewBox="-1200 -600 2400 1200">
				<g id="svgGrid" class="grid"></g>
			</svg>
		</output>
		<form name="matrix" onchange="formOnchange()">
			<h2>matrix values</h2>
			<div class="matrixValues">
			<label>
				<input name="a" type="number" value="1" min="-5" max="5" step="0.5">
				a - scaleX
			</label>
			<label>
				<input name="b" type="number" value="0" min="-5" max="5" step="0.5">
				b - skewY
			</label>
			<label>
				<input name="c" type="number" value="0" min="-5" max="5" step="0.5">
				c - skewX
			</label>
			<label>
				<input name="d" type="number" value="1" min="-5" max="5" step="0.5">
				d - scaleY
			</label>
			<label>
				<input name="e" type="number" value="0" min="-100" max="100" step="25">
				e - translateX
			</label>
			<label>
				<input name="f" type="number" value="0" min="-100" max="100" step="25">
				f - translateY
			</label>
			</div>

			<h2>mutators</h2>

			<label><input name="rotate" type="number" value="0" min="-180" max="180" step="15"> rotate </label>
			<label>
				<input type="checkbox" name="invert"> invert
			</label>

			<button type="reset" onclick="formReset()">reset</button>
		</form>



		<script contenteditable="true">
			function formOnchange() {
				//console.log('formOnchange')
				let matrix = new DOMMatrix([
					document.forms.matrix.a.value,
					document.forms.matrix.b.value,
					document.forms.matrix.c.value,
					document.forms.matrix.d.value,
					document.forms.matrix.e.value,
					document.forms.matrix.f.value,
				]);

				matrix.rotateSelf(document.forms.matrix.rotate.value);

				if (document.forms.matrix.invert.checked) {
					matrix.invertSelf();
				}

				console.log(matrix);
				svgGrid.setAttribute('transform', matrix.toString());

			}

			const identity = new DOMMatrixReadOnly([
				1, 0, 0,
				1, 0, 0,
			]);

			function formReset() {
				console.log('formReset', identity);
				svgGrid.setAttribute('transform', identity);
			}


			function rotate(degrees) {
				const radians = (degrees/180) * Math.PI;
				const result = new DOMMatrix([
					Math.cos(angle) * scaleX,
					Math.sin(angle) * scaleX,
					-Math.sin(angle) * scaleY,
					Math.cos(angle) * scaleY,
					translateX,
					translateY,
				]);
				return result;
			}


		</script>

	</main>

</body>
</html>