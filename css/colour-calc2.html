<!doctype html>
<html lang="en">
<head>
	<title>Colour calc 2</title>
	<meta charset="utf-8">
	<link rel="icon" href="../[html-common]/favicon/css.svg">
	<link rel="stylesheet" href="../[common]/common-style.css">
	<link rel="stylesheet" href="../[common]/transition.css">
	<link rel="stylesheet" href="../[common]/background.css">
	<script defer src="../[common]/colourScheme-selector.js"></script>
	<script src="../[common]/common-script.js"></script>

</head>
<body onload="generateSwatches();">
	<header>
		<nav>
			<a class="colourScheme-selector" href="?colourScheme=light" title="Light colour scheme" data-colourScheme="light">ðŸŸ“</a>
			<a class="colourScheme-selector" href="?colourScheme=dark" title="Dark colour scheme" data-colourScheme="dark">ðŸŸ’</a>
			<a title="To folder" href="./">ðŸ–¿</a>
			<a title="Parent folder" href="../">ðŸ¡…</a>
		</nav>

		<h1><a href="">Colour calc 2</a></h1>
	</header>

	<main>


		<form onchange="generateSwatches();" class="fullwidth">
			<h2>Settings</h2>

			<label for="input-colour">
				Colour inputs
				<textarea id="input-colour" spellcheck="false">
					var(--text-colour)
					var(--project-colour)
					mediumvioletred

					red
					blue
					green
					#f7df1e
					#ffb13b
					rebeccapurple
					navy
					bisque
					black
					white
				</textarea>
			</label>

			<label for="input-colourExpression">
				Colour expressions
				<textarea id="input-colourExpression" spellcheck="false">
					[
						{
							"text"       : "hsl( from var(--row-colour)    h s calc(sign(l - 51) * -100))",
							"background" : "hsl( from var(--row-colour)    h s l / 1)",
							"border"     : "hsl( from var(--row-colour)    h s 50 / 0.5)"
						},
						{
							"text"       : "hsl( from var(--row-colour)    h s calc(sign(l - 51) * -100))",
							"background" : "hsl( from var(--row-colour)    h s l / var(--alpha75))",
							"border"     : "hsl( from var(--row-colour)    h s 50 / 1)"
						},
						{
							"text"       : "var(--text-colour)",
							"background" : "hsl( from var(--row-colour)    h s l / var(--alpha50))",
							"border"     : "hsl( from var(--row-colour)    h s 50 / 1)"
						},
						{
							"text"       : "var(--text-colour)",
							"background" : "hsl( from var(--row-colour)    h s l / var(--alpha25))",
							"border"     : "hsl( from var(--row-colour)    h s 50 / 1)"
						}
					]
				</textarea><!-- beware - JSON barfs on tabs in strings... -->
			</label>

			<button type="button" onclick="generateSwatches()">generate swatches</button>
		</form>


		<output class="fullwidth">
			<h3>Generated swatches</h3>
			<table class="swatches ">
			<thead id="result-thead">
			</thead>
			<tbody id="result-tbody" class="background-crosshatch">
			</tbody>
			</table>
		</output>

		<pre>
			Text
			----
			Against solid backgrounds this works:

				hsl    h s calc(sign(l - 51) * -100)

			Against transparent bacgkrounds will depend on the colour scheme.
			At around 0.75 alpha dark-scheme contrast suffers.
			So the actual text-colour will need to be a function of the alpha and a threshold.



			Lightness Inversion:
			hsl		h s calc(100 - l)

			Darken:
			hsl		h s calc(l / 2)

			Lighten:
			hsl		h s calc(l + (100 - l) / 2)

		</pre>





		<style contenteditable="plaintext-only" >
			:root {
				--alpha25: 0.25;
				--alpha50: 0.50;
				--alpha75: 0.75;
			}
			form {
				display:grid;
				grid-template-columns: 1fr 1fr;
				h2 {
					grid-column-start: span 2;
				}
				tab-size:1;
			}

			label { display:block; }
			output table {
				font-family:monospace;
					border-collapse: separate;
					border-spacing: 0ex;
				width: 100%;
				border: transparent;
				th { padding:1em; text-align: center; border: transparent; font-size:large; }
				td { padding:1em; }
				tbody th {
					background-color: var(--row-colour);
					color: hsl(from var(--row-colour) h 0 calc(sign(l - 51) * -100));
				}
				/* td { text-align: center; } */
			}
		</style>


		<script class="fullwidth">

			function generateSwatches() {
				let result = '';
				const colourText = document.getElementById('input-colour').value.trim();
				const colourArray = colourText.split('\n').map((element)=>element.trim());
				console.log(colourArray);


				const expressionText = document.getElementById('input-colourExpression').value.trim();
				const expressionArray = JSON.parse(expressionText);
				console.log(expressionArray);

				let headerCells = '';
				let trow = '';
				let rowCells = '';
				let tbody = '';
				let colourCalc = '';


				// header
				for (let col=0; col < expressionArray.length; col++) {
					headerCells +=
						`<th>${JSON.stringify(expressionArray[col]).replaceAll(',',',</br>')}</th>`;
				}
				let thead = `
					<tr>
						<th></th>
						${headerCells}
					</tr>
				`;
				document.getElementById('result-thead').innerHTML = thead;


				// body
				for (let row=0; row < colourArray.length; row++) {
					rowCells  = '';

					for (let col=0; col < expressionArray.length; col++) {

						let styleText = `
							color: ${expressionArray[col].text};
							background: ${expressionArray[col].background};
							border: ${expressionArray[col].border} 1ex solid;
						`;

						rowCells += `
							<td style="${styleText}">
								${styleText.replaceAll(';',';</br>')}
							</td>
						`;
					}
					trow = `
						<tr style="--row-colour:${colourArray[row]}">
							<th>${colourArray[row]}</th>
							${rowCells}
						</tr>
					`;

					tbody += trow;
				}
				document.getElementById('result-tbody').innerHTML = tbody;
			}


			function getColourExpression(colour, calcString) {

				const match = calcString.match(/\s*(\w+)\s+(.*)/);
				//console.log('match',match);
				const colourModel = match[1];
				const colourCalc = match[2];

				result = `${colourModel}(from ${colour} ${colourCalc})`;
				return result;
			}


		</script>


	</main>

</body>
</html>