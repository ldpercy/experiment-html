<!doctype html>
<html lang="en">
<head>
	<title>colour-calc</title>
	<meta charset="utf-8">
	<link rel="icon" href="../[common]/favicon.svg">
	<link rel="stylesheet" href="../[common]/common-style.css">
	<link rel="stylesheet" href="../[common]/transition.css">
	<link rel="stylesheet" href="../[common]/background.css">
	<script defer src="../[common]/colourScheme-selector.js"></script>
	<script src="../[common]/common-script.js"></script>

</head>
<body onload="generateSwatches();">
	<header>
		<nav>
			<a class="colourScheme-selector" href="?colourScheme=light" title="Light colour scheme" data-colourScheme="light">ðŸŸ“</a>
			<a class="colourScheme-selector" href="?colourScheme=dark" title="Dark colour scheme" data-colourScheme="dark">ðŸŸ’</a>
			<a title="To folder" href="./">ðŸ–¿</a>
			<a title="Parent folder" href="../">ðŸ¡…</a>
		</nav>

		<h1><a href="">colour calc</a></h1>
	</header>

	<main>

		<style contenteditable="plaintext-only" >

			label { display:block; }
			output table {
				font-family:monospace;
				width: 100%;
				th { padding:2em; }
				tbody th {
					background-color: var(--row-colour);
				}
				td { text-align: center; }
			}
		</style>


		<form onchange="generateSwatches();">
			<h2>Settings</h2>

			<label for="input-colour">
				Colour inputs
			</label>
			<textarea id="input-colour" spellcheck="false">
				#663399
				#f7df1e
				mediumvioletred
				orangered
				#ffb13b
			</textarea>

			<!--
				dodgerblue
				plum
				springgreen
				aqua
				oldlace
				floralwhite
				beige
			-->

			<label for="input-calculation">
				Calculations
			</label>
			<textarea id="input-calculation" spellcheck="false">
				hsl		h s l / 0.2
				hsl		h s 50 / 0.5
				hwb		h w 20 / 0.5
			</textarea>
			<br/>
			<button type="button" onclick="generateSwatches()">generate swatches</button>
		</form>


		<output class="fullwidth">
			<h3>Calculation results</h3>
			<table class="swatches ">
			<thead id="result-thead">
			</thead>
			<tbody id="result-tbody" class="background-crosshatch">
			</tbody>
			</table>
		</output>



		<script>

			function generateSwatches() {
				let result = '';
				const colourText = document.getElementById('input-colour').value.trim();
				const colourArray = colourText.split('\n').map((element)=>element.trim());
				console.log(colourArray);

				const calculationText = document.getElementById('input-calculation').value.trim();
				const calculationArray = calculationText.split('\n').map(
					(calcLine) => {
						let match = calcLine.match(/\s*(\w+)\s+(.*)/);
						//console.log('match',match);
						let result = {
							model : match[1],
							calc : match[2],
						}
						//return calcLine.trim();
						return result;
					}

				);
				console.log(calculationArray);



				let headerCells = '';
				let trow = '';
				let rowCells = '';
				let tbody = '';
				let colourCalc = '';


				// header
				for (let col=0; col < calculationArray.length; col++) {
					headerCells += `<th>${calculationArray[col].model}(from color ${calculationArray[col].calc})</th>`;
				}
				let thead = `
					<tr>
						<th></th>
						${headerCells}
					</tr>
				`;
				document.getElementById('result-thead').innerHTML = thead;


				// body
				for (let row=0; row < colourArray.length; row++) {
					rowCells  = '';

					for (let col=0; col < calculationArray.length; col++) {

						colourCalc = `${calculationArray[col].model}(from ${colourArray[row]} ${calculationArray[col].calc})`;

						rowCells += `<td style="background-color:${colourCalc}">${colourCalc}</td>`;
					}
					trow = `
						<tr style="--row-colour:${colourArray[row]}">
							<th>${colourArray[row]}</th>
							${rowCells}
						</tr>
					`;

					tbody += trow;
				}
				document.getElementById('result-tbody').innerHTML = tbody;
			}



			/** swatchesHSL
			 * @param {string} colour
			 * @param {string} channel
			 * @param {number} divisions
			 */
			function swatchesHSL(colour, channel, divisions) {
				// channel = hue saturation lightness alpha
				let result = '';

				switch(channel) {
					case 'h': max = 360; break;
					case 's': max = 100; break;
					case 'l': max = 100; break;
					case 'a': max = 1; break;
				}
				const step = max/divisions;

				let val = 0;
				let h, s, l, a;
				let colourString = '';

				for (i=0; i<=divisions; i++) {
					val = i * step;
					h	= (channel === 'h') ? `calc(h + ${val.toFixed(2)})` : 'h';
					s	= (channel === 's')	? `${val.toFixed(2)}` : 's';
					l	= (channel === 'l')	? `${val.toFixed(2)}` : 'l';
					a	= (channel === 'a')	? `${val.toFixed(3)}` : 'alpha';

					colourString = `hsl(from ${colour} ${h} ${s} ${l} / ${a})`;
					result += `<span style="background-color: ${colourString};">${colourString}</span>`;
				}

				return result;
			}/* swatchesHSL */



		</script>


	</main>

</body>
</html>